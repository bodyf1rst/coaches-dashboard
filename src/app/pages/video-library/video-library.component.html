<div class="video-library-container">
  <!-- Header Section -->
  <div class="library-header">
    <h1>üìö Video Library</h1>
    <p class="subtitle">Browse and manage your workout, nutrition, and mindset videos</p>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button
      *ngFor="let cat of categories"
      class="category-btn"
      [class.active]="selectedCategory === cat.value"
      (click)="selectCategory(cat.value)">
      <span class="cat-icon">{{cat.icon}}</span>
      <span class="cat-label">{{cat.label}}</span>
    </button>
  </div>

  <!-- 4 Filter Dropdowns -->
  <div class="filters-dropdowns">
    <div class="dropdown-group">
      <label for="muscleGroupFilter">Muscle Group</label>
      <select id="muscleGroupFilter" [(ngModel)]="selectedMuscleGroup" (ngModelChange)="onFilterChange()" class="filter-dropdown">
        <option *ngFor="let group of muscleGroups" [value]="group.value">{{group.label}}</option>
      </select>
    </div>

    <div class="dropdown-group">
      <label for="equipmentFilter">Equipment</label>
      <select id="equipmentFilter" [(ngModel)]="selectedEquipment" (ngModelChange)="onFilterChange()" class="filter-dropdown">
        <option *ngFor="let equip of equipmentOptions" [value]="equip.value">{{equip.label}}</option>
      </select>
    </div>

    <div class="dropdown-group">
      <label for="difficultyFilter">Difficulty</label>
      <select id="difficultyFilter" [(ngModel)]="selectedDifficulty" (ngModelChange)="onFilterChange()" class="filter-dropdown">
        <option *ngFor="let level of difficultyLevels" [value]="level.value">{{level.label}}</option>
      </select>
    </div>

    <div class="dropdown-group">
      <label for="bodyAreaFilter">Body Area</label>
      <select id="bodyAreaFilter" [(ngModel)]="selectedBodyArea" (ngModelChange)="onFilterChange()" class="filter-dropdown">
        <option *ngFor="let area of bodyAreas" [value]="area.value">{{area.label}}</option>
      </select>
    </div>
  </div>

  <!-- Search and Filters Bar -->
  <div class="filters-bar">
    <div class="search-box">
      <i class="fa fa-search"></i>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange()"
        placeholder="Search videos by title, description, transcription, or tags...">
      <button *ngIf="searchQuery" class="clear-search" (click)="searchQuery=''; onSearchChange()">
        <i class="fa fa-times"></i>
      </button>
    </div>
    <div class="filter-actions">
      <button class="multi-select-btn" [class.active]="multiSelectMode" (click)="toggleMultiSelectMode()">
        <i class="fa" [class.fa-check-square]="multiSelectMode" [class.fa-square-o]="!multiSelectMode"></i>
        {{ multiSelectMode ? 'Exit Selection' : 'Select Multiple' }}
      </button>
      <button class="add-to-workout-btn" *ngIf="multiSelectMode && selectedVideoIds.size > 0" (click)="addSelectedToWorkout()">
        <i class="fa fa-plus-circle"></i> Add to Workout ({{selectedVideoIds.size}})
      </button>
      <button class="clear-filters-btn" *ngIf="selectedCategory !== 'all' || selectedMuscleGroup !== 'all' || selectedEquipment !== 'all' || selectedDifficulty !== 'all' || selectedBodyArea !== 'all' || selectedTags.length > 0 || searchQuery" (click)="clearFilters()">
        <i class="fa fa-times-circle"></i> Clear All Filters
      </button>
    </div>
  </div>

  <!-- Tags Filter -->
  <div class="tags-section" *ngIf="availableTags.length > 0">
    <div class="tags-header">
      <span class="tags-label">Filter by Tags:</span>
      <span class="tags-count">{{selectedTags.length}} selected</span>
    </div>
    <div class="tags-container">
      <button
        *ngFor="let tag of availableTags"
        class="tag-chip"
        [class.selected]="selectedTags.includes(tag)"
        (click)="toggleTag(tag)">
        {{tag}}
        <i *ngIf="selectedTags.includes(tag)" class="fa fa-check"></i>
      </button>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>üîÑ Loading videos from API...</p>
  </div>

  <!-- Results Count -->
  <div class="results-info" *ngIf="!loading">
    <span class="results-count">
      Showing {{filteredVideos.length}} of {{videos.length}} videos
    </span>
  </div>

  <!-- Videos Grid -->
  <div class="videos-grid" *ngIf="!loading && filteredVideos.length > 0">
    <div
      *ngFor="let video of filteredVideos"
      class="video-card"
      [class.multi-select-mode]="multiSelectMode"
      [class.selected]="isVideoSelected(video.id)"
      (click)="multiSelectMode ? toggleVideoSelection(video.id) : openVideoModal(video)">

      <!-- Selection Checkbox (visible in multi-select mode) -->
      <div class="selection-checkbox" *ngIf="multiSelectMode" (click)="$event.stopPropagation(); toggleVideoSelection(video.id)">
        <input type="checkbox" [checked]="isVideoSelected(video.id)" readonly>
        <i class="fa fa-check-circle" *ngIf="isVideoSelected(video.id)"></i>
      </div>

      <div class="video-thumbnail">
        <img [src]="getThumbnailUrl(video)" [alt]="video.title" crossorigin="anonymous" (error)="onImageError($event, video)">
        <div class="play-button-overlay" *ngIf="!multiSelectMode">
          <i class="fa fa-play"></i>
        </div>
        <div class="video-duration">{{formatDuration(video.duration)}}</div>
        <div class="video-category-badge" [class]="video.category">
          {{video.category}}
        </div>
      </div>
      <div class="video-info">
        <h3 class="video-title">{{video.title}}</h3>
        <div class="video-tags" *ngIf="video.tags && video.tags.length > 0">
          <span class="tag" [ngClass]="getTagClass(tag)" *ngFor="let tag of video.tags.slice(0, 5)">{{tag}}</span>
          <span class="more-tags" *ngIf="video.tags.length > 5">+{{video.tags.length - 5}}</span>
        </div>
        <p class="video-description">{{video.description || 'No description available'}}</p>
        <div class="video-meta">
          <span class="video-date">
            <i class="fa fa-calendar"></i> {{formatDate(video.uploadedAt)}}
          </span>
          <span class="video-uploader">
            <i class="fa fa-user"></i> {{video.uploadedBy}}
          </span>
        </div>
      </div>
      <div class="video-actions" (click)="$event.stopPropagation()">
        <button class="action-btn delete" (click)="deleteVideo(video, $event)" title="Delete Video">
          <i class="fa fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div class="no-results" *ngIf="!loading && filteredVideos.length === 0 && videos.length > 0">
    <div class="no-results-icon">üîç</div>
    <h3>No videos found</h3>
    <p>Try adjusting your filters or search query</p>
    <button class="btn-primary" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && videos.length === 0">
    <div class="empty-icon">üìπ</div>
    <h3>No videos yet</h3>
    <p>Your video library is empty. Upload some videos to get started!</p>
  </div>
</div>

<!-- Video Modal -->
<div class="video-modal-overlay" *ngIf="showVideoModal && selectedVideo" (click)="closeVideoModal()">
  <div class="video-modal" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeVideoModal()">
      <i class="fa fa-times"></i>
    </button>

    <div class="modal-content">
      <div class="video-player-section">
        <video controls crossorigin="anonymous" preload="metadata" [src]="getVideoUrl(selectedVideo)" [poster]="getThumbnailUrl(selectedVideo)">
          <source [src]="getVideoUrl(selectedVideo)" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>

      <div class="video-details-section">
        <div class="video-header">
          <h2 class="video-modal-title">{{selectedVideo.title}}</h2>
          <span class="category-badge" [class]="selectedVideo.category">{{selectedVideo.category}}</span>
        </div>

        <div class="section-block description-block" *ngIf="selectedVideo.description">
          <h4 class="section-title"><i class="fa fa-info-circle"></i> Description</h4>
          <p class="video-description-full">{{selectedVideo.description}}</p>
        </div>

        <div class="section-block transcription-block" *ngIf="selectedVideo.transcription">
          <h4 class="section-title"><i class="fa fa-file-text"></i> Transcription</h4>
          <div class="transcription-text">
            {{selectedVideo.transcription}}
          </div>
        </div>

        <div class="section-block transcription-block empty" *ngIf="!selectedVideo.transcription">
          <p class="empty-message"><i class="fa fa-info-circle"></i> No transcription available for this video.</p>
        </div>

        <div class="section-block tags-block" *ngIf="selectedVideo.tags && selectedVideo.tags.length > 0">
          <h4 class="section-title"><i class="fa fa-tags"></i> Tags</h4>
          <div class="tags-list">
            <span class="tag" [ngClass]="getTagClass(tag)" *ngFor="let tag of selectedVideo.tags">{{tag}}</span>
          </div>
        </div>

        <div class="section-block metadata-block">
          <h4 class="section-title"><i class="fa fa-info"></i> Video Information</h4>
          <div class="video-metadata">
            <div class="meta-item">
              <i class="fa fa-clock"></i>
              <span>Duration: {{formatDuration(selectedVideo.duration)}}</span>
            </div>
            <div class="meta-item">
              <i class="fa fa-calendar"></i>
              <span>Uploaded: {{formatDate(selectedVideo.uploadedAt)}}</span>
            </div>
            <div class="meta-item">
              <i class="fa fa-user"></i>
              <span>By: {{selectedVideo.uploadedBy}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
